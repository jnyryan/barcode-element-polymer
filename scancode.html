<link rel="import" href="../polymer/polymer.html">
<script type="text/javascript" src="../jquery/dist/jquery.js"></script>
<script type="text/javascript" src="../jquery-barcode/jquery-barcode.js"></script>
<script type="text/javascript" src="lib/qrcode.js"></script>

<dom-module id="scan-code">
  <template>
      <div id="scancode" style="text-align:center;"></div>
    </template>
  <script>
    Polymer({
      is: 'scan-code',
      properties: {
        colorDark: { observer: 'colorDarkChanged' },
        colorLight: { observer: 'colorLightChanged' },
        data: { observer: 'dataChanged' },
        format: { observer: 'formatChanged' },
        height: { observer: 'heightChanged' },
        is: {
          type: String,
          value: 'scan-code'
        },
        properties: {
          type: Object,
          value: function () {
            return {
              data: {
                type: String,
                observer: 'dataChanged'
              },
              type: {
                type: String,
                observer: 'typeChanged'
              },
              format: {
                type: String,
                observer: 'formatChanged'
              },
              height: {
                type: String,
                observer: 'heightChanged'
              },
              width: {
                type: String,
                observer: 'widthChanged'
              },
              colordark: {
                type: String,
                observer: 'colorDarkChanged'
              },
              colorlight: {
                type: String,
                observer: 'colorLightChanged'
              }
            };
          }
        },
        type: { observer: 'typeChanged' },
        width: { observer: 'widthChanged' }
      },
      ready: function () {
        this.generate();
      },
      dataChanged: function () {
        this.generate();
      },
      typeChanged: function () {
        this.generate();
      },
      formatChanged: function () {
        this.generate();
      },
      heightChanged: function () {
        this.generate();
      },
      widthChanged: function () {
        this.generate();
        console.debug('changed');
      },
      colorDarkChanged: function () {
        console.debug('changed');
        this.generate();
      },
      colorLightChanged: function () {
        console.debug('changed');
        this.generate();
      },
      generate: function () {
        var rendered = false;
        if (this.data) {
          try {
            if (this.type === 'barcode') {
              rendered = this.generateBarcode();
            }
            else if (this.type === 'qrcode') {
              rendered = this.generateQRcode();
            }
          }
          catch (err) {
            console.dir(err);
          }
        }

        if (!rendered) {
          console.debug("Not Rendering scancode");
          var el = this.$.scancode;
          el.innerHTML = "";
        }

        return rendered;
      },
      generateQRcode: function () {
        var el = this.$.scancode;
        Polymer.dom(el).innerHTML = '';
        //console.debug(this.colorDark);
        var qrcode = new QRCode(el, {
          text: this.data,
          width: this.width,
          height: this.height,
          colorDark: this.colordark || '#000000',
          colorLight: this.colorlight || '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
        return true;
      },
      generateBarcode: function () {
        var el = this.$.scancode;
        $(el).barcode({
          code: this.data,
          crc: false
        }, this.format || 'codabar', {
          barWidth: this.width,
          barHeight: this.height
        });
        return true;
      }
    });
  </script>
</dom-module>
